import{j as s,r as o,c as H,B as J,f as ee,h as Q,i as se,d as M,a as T,k as ne,l as re,u as X,g as ce,m as ie}from"./index-CimYRKbA.js";const de="_foldersWrapper_wjit0_9",pe="_foldersBottomNav_wjit0_70",ue="_foldersBox_wjit0_100",he="_folderPathWrapper_wjit0_112",fe="_hideFolderInput_wjit0_133",me="_folderInput_wjit0_137",xe="_close_wjit0_137",_e="_folder_wjit0_9",je="_file_wjit0_142",ge="_open_wjit0_175",Ne="_selected_wjit0_207",u={foldersWrapper:de,foldersBottomNav:pe,foldersBox:ue,folderPathWrapper:he,hideFolderInput:fe,folderInput:me,close:xe,folder:_e,file:je,open:ge,selected:Ne},Fe="_foldersBottomNav_9h9hf_1",Be="_left_9h9hf_8",ye="_uncheck_9h9hf_8",ve="_right_9h9hf_17",Ce="_fullContent_9h9hf_32",C={foldersBottomNav:Fe,left:Be,uncheck:ye,right:ve,fullContent:Ce},we=({deleteSelectedFolder:d,setSelecting:h,handleSelectingAll:f})=>s.jsxs("div",{className:C.foldersBottomNav,children:[s.jsxs("div",{className:C.left,children:[s.jsxs("button",{onClick:()=>{f(!0)},children:[s.jsx("i",{className:"fa fa-check"}),s.jsx("span",{className:C.fullContent,children:"Select All"})]}),s.jsxs("button",{onClick:()=>{f(!1)},children:[s.jsx("i",{className:`fa fa-check-square ${C.uncheck}`}),s.jsx("span",{className:C.fullContent,children:"Unselect All"})]})]}),s.jsxs("div",{className:C.right,children:[s.jsxs("button",{onClick:()=>{d()},children:[s.jsx("i",{className:"fa fa-trash"}),s.jsx("span",{className:C.fullContent,children:"Delete"})]}),s.jsxs("button",{onClick:()=>{h(!1),f(!1)},children:[s.jsx("i",{className:"fa fa-close"}),s.jsx("span",{className:C.fullContent,children:"Cancel"})]})]})]}),be="_foldersNav_8tlzv_1",Se="_horizontalLine_8tlzv_10",Pe="_right_8tlzv_24",ke="_uploadWrapper_8tlzv_33",z={foldersNav:be,horizontalLine:Se,right:Pe,uploadWrapper:ke},We="_uploaderWrapper_11yss_1",Ue="_progressBarWrapper_11yss_14",$e="_hidesProgressBarWrapper_11yss_14",De="_showProgressButton_11yss_39",Ie="_progressBarBox_11yss_56",Re="_uploadingFile_11yss_70",Ae="_wrapNameAndBar_11yss_101",Le="_bar_11yss_109",Oe="_barColor_11yss_117",ze="_wrapNameAndProgress_11yss_124",Me="_uploaderBox_11yss_136",Te="_uploaderBoxLabel_11yss_149",Ee="_closeButton_11yss_164",p={uploaderWrapper:We,progressBarWrapper:Ue,hidesProgressBarWrapper:$e,showProgressButton:De,progressBarBox:Ie,uploadingFile:Re,wrapNameAndBar:Ae,bar:Le,barColor:Oe,wrapNameAndProgress:ze,uploaderBox:Me,uploaderBoxLabel:Te,closeButton:Ee},Ke=({uploaderPrompt:d,setUploaderPrompt:h})=>{const f=o.useRef(),{user:$,setLoading:D,setFoldersCache:E}=o.useContext(H),{folderPath:I,setFilesAndFolders:R,filesAndFolders:b}=o.useContext(te),[N,A]=o.useState(!1),[L,Y]=o.useState(!0),[S,B]=o.useState([]),[P,K]=o.useState([]),y=async n=>{var m,F;D(!0);const c=n;A(!0);for(let i=0;i<c.length;i++)B(j=>[...j,{prog:0,name:c[i].name}]);K([...c]);for(let i=0;i<c.length;i++){let j="qwertyuiopasdfghjklzxcvbnm",v="";for(let w=0;w<15;w++){let _=Math.floor(Math.random()*j.length);v=v.concat(j[_])}const k=ee(se,`${(m=Q.currentUser)==null?void 0:m.uid}/${I}/${v+"_"+c[i].name}`),O=M(T,"Users",(F=Q.currentUser)==null?void 0:F.uid);try{if(c[i]){var r=b;const w=ne(k,c[i]);w.on("state_changed",_=>{const W=Math.floor(_.bytesTransferred/_.totalBytes*100);B(q=>q.map((U,Z)=>U.name==c[i].name?{...U,prog:W}:{...U}))},_=>{console.log(_)},()=>{re(w.snapshot.ref).then(_=>{R(W=>[{name:c[i].name,fileType:c[i].type,fullName:v+"_"+c[i].name,url:_,dateCreated:Date.now(),isSelected:!1,id:Math.random()*1,type:"file",path:I},...W]),r.push({name:c[i].name,fileType:c[i].type,fullName:v+"_"+c[i].name,url:_,dateCreated:Date.now(),isSelected:!1,id:Math.random()*1,type:"file",path:I}),E([...r]),X(O,{folders:b})})})}}catch{console.log("No file selected."),D(!1)}}D(!1)};if(d)return s.jsxs("div",{className:p.uploaderWrapper,children:[s.jsx("input",{type:"file",id:"fileUploader",accept:"*",ref:f,onChange:n=>{y(n.target.files)},multiple:!0}),s.jsxs("div",{className:N?p.progressBarWrapper:p.hidesProgressBarWrapper,children:[s.jsx(J,{icon:N?s.jsx("i",{className:"fa fa-arrow-up"}):s.jsx("i",{className:"fa fa-arrow-down"}),content:N?"Hide Progress Bar":"Show Progress Bar",func:()=>{A(!N)},className:p.showProgressButton}),s.jsx("h3",{children:"Progress Bar"}),s.jsxs("div",{className:p.progressBarBox,children:[s.jsx("h4",{children:"Files:"}),P==null?void 0:P.map((n,c)=>{var r,m,F;return s.jsxs("div",{className:p.uploadingFile,children:[n.type.includes("image")?s.jsx("img",{src:URL.createObjectURL(n)}):s.jsx("i",{className:"fa fa-file"}),s.jsxs("div",{className:p.wrapNameAndBar,children:[s.jsx("div",{className:p.bar,children:s.jsx("div",{className:p.barColor,style:{width:`${(r=S[c])==null?void 0:r.prog}%`}})}),s.jsxs("div",{className:p.wrapNameAndProgress,children:[s.jsx("span",{className:p.name,children:(m=S[c])==null?void 0:m.name}),s.jsxs("span",{className:p.progress,children:[(F=S[c])==null?void 0:F.prog,"%"]})]})]})]},n==null?void 0:n.lastModified)})]})]}),s.jsxs("div",{className:L?p.uploaderBox:p.hideUploaderBox,children:[s.jsx(J,{icon:s.jsx("i",{className:"fa fa-close"}),className:p.closeButton,func:()=>{h(!1)}}),s.jsxs("label",{className:p.uploaderBoxLabel,htmlFor:"fileUploader",onDragOver:n=>{n.preventDefault()},onDrop:n=>{n.preventDefault(),y(n.dataTransfer.files)},children:[s.jsx("img",{src:"./Folder/cloudUpload.png",alt:""}),s.jsx("p",{children:"Click to Upload"}),s.jsx("p",{children:"or Drop Files to Upload"})]})]})]})},qe=({setShowFolderInput:d})=>{const[h,f]=o.useState(!1);return s.jsxs("div",{className:z.foldersNav,children:[s.jsx("h1",{children:"Folders"}),s.jsxs("div",{className:z.right,children:[s.jsx("button",{children:"Create"}),s.jsxs("div",{className:z.uploadWrapper,children:[s.jsxs("button",{onClick:()=>{f(!0)},children:[s.jsx("i",{className:"fa fa-file"}),s.jsx("span",{children:"Upload File"})]}),s.jsxs("button",{onClick:()=>{d(!0)},children:[s.jsx("i",{className:"	fa fa-folder"}),s.jsx("label",{htmlFor:"folderInput",children:"Create Folder"})]})]})]}),s.jsx("span",{className:z.horizontalLine}),s.jsx(Ke,{uploaderPrompt:h,setUploaderPrompt:$=>{f($)}})]})},te=o.createContext(),Ge=()=>{const{user:d,setLoading:h,foldersCache:f,setShowMakeUserSignIn:$}=o.useContext(H),{setPages:D,imageContent:E,setImageContent:I}=o.useContext(H),R=o.useRef(null),[b,N]=o.useState(null),[A,L]=o.useState(null),[Y,S]=o.useState(!1),[B,P]=o.useState(!1),[K,y]=o.useState(!1),[n,c]=o.useState("Folders/"),[r,m]=o.useState(f),[F,i]=o.useState([]),[j,v]=o.useState([{name:"Folders",path:"Folders/"}]),[k,O]=o.useState([]);function w(e){let t=r,a=[];for(let l in t)e.id==t[l].id&&(t[l].isSelected=!t[l].isSelected);for(let l in r)r[l].isSelected&&a.push(r[l]);console.log(),O([...a]),m([...t])}function _(e){i(l=>l.map(x=>({...x,isSelected:!!e})));let t=r,a=[];for(let l in t)t[l].isSelected=!!e,e&&a.push(t[l].id);O([...a])}function W(e){console.log(n);const t={name:e.target.value,dateCreated:Date.now(),isSelected:!1,id:Math.floor(Math.random()*1e6),type:"folder",path:n},a=e.target.value;if(e.key=="Enter"){if(a!=""){let x=[t,...r];V(x),m(g=>[t,...g])}else y(!1);y(!1),e.target.value=""}}function q(e,t){const a=e.target.value,l=e.key;let x=r;console.log(t.name),l=="Enter"&&(a!=""?(x=x.map(g=>t.name==g.name?{...g,name:a}:{...g}),V(x),m(g=>g.map(G=>t.name==G.name?{...G,name:a}:{...G}))):L(null),N(null))}function U(e){let t=[],a=j;if(console.log(a.length),a.length!=1){for(let l in t)t[l].path==n&&t.push(t[l]);for(let l in j)if(j[l].path==e.path){for(let x=j.length-1;x!=l;x--)a.splice(x,1);break}v([...a]),i([...t])}}function Z(e){if(e.type=="folder"){e!=null&&e.name&&c(n+(e==null?void 0:e.name)+"/"),v(a=>[...a,{name:e==null?void 0:e.name,path:(e==null?void 0:e.path)+(e==null?void 0:e.name)+"/"}]);let t=[];for(let a in t)t[a].path==n&&t.push(t[a]);i([...t])}else S(!0)}const ae=async()=>{var t;let e=r;if(e.length!=0){h(!0);try{for(let a in k)for(let l in e)k[a].id==e[l].id&&(k[a].type=="folder"||await ie(ee(se,`/${(t=Q.currentUser)==null?void 0:t.uid}/${n}/${k[a].fullName}`)),e.splice(l,1));await X(M(T,"Users",d.uid),{folders:e}),h(!1)}catch(a){console.log(a),h(!1)}O([]),m([...e])}},V=async e=>{const t=M(T,"Users",d==null?void 0:d.uid);try{await X(t,{folders:e||r})}catch(a){console.log(a)}};o.useEffect(()=>{if(n!=""){let e=[],t=[],a=[];for(let l in r)r[l].path===n&&e.push(r[l]);for(let l in e)e[l].type=="folders"?a.push(e[l]):t.push(e[l]);a&&t&&i([...a,...t])}},[n,r]),o.useEffect(()=>{if((f==null?void 0:f.length)==0&&d&&(r==null?void 0:r.length)==0){const e=async t=>{var a;h(!0);try{const l=M(T,"Users",t),g=(a=(await ce(l)).data())==null?void 0:a.folders;g.length!=0&&m([...g]),h(!1)}catch(l){console.log(l),h(!1)}h(!1)};d!=null&&d.uid&&e(d.uid)}},[d]),o.useEffect(()=>{d!=null&&d.uid?$(!1):$(!0)},[d]),o.useEffect(()=>{D(e=>e.map(t=>t.name==="Folders"?{...t,ind:!0}:{...t,ind:!1}))},[]);const le={openFile:Y,setOpenFile:S,imageContent:E,setImageContent:I,folderPath:n,setFilesAndFolders:m,filesAndFolders:r,folderInputRef:R,saveToDatabase:()=>{V()}},oe=({folder:e})=>s.jsx(s.Fragment,{children:e.fileType.includes("image")?s.jsx("input",{type:"image",src:e.url,width:"16px",style:{marginRight:"1rem"}}):s.jsx("i",{className:"fa fa-file"})});return s.jsx(te.Provider,{value:le,children:s.jsxs("div",{className:u.foldersWrapper,children:[s.jsx(qe,{createFolder:W,setShowFolderInput:y}),B?s.jsx(we,{selecting:B,setSelecting:P,handleSelectingAll:_,deleteSelectedFolder:ae}):s.jsx("div",{className:u.foldersBottomNav,children:s.jsx("button",{onClick:()=>{P(!0)},children:"Select Folders"})}),s.jsxs("div",{className:u.foldersBox,children:[s.jsx("div",{className:u.folderPathWrapper,children:s.jsx("h3",{children:j.map(e=>e.path=="Folders/"?s.jsx("span",{children:s.jsxs("span",{onClick:()=>{c(e.path),U(e)},children:[e.name," "]})},e.name+e.path):s.jsxs("span",{children:["/ ",s.jsxs("span",{onClick:()=>{c(e.path),U(e)},children:[e.name," "]})]},e.name+e.path))})}),s.jsxs("div",{className:K?u.folderInput:u.hideFolderInput,children:[s.jsx("i",{className:"fa fa-folder"}),s.jsx("input",{type:"text",ref:R,id:"folderInput",onBlur:()=>{y(!1),R.current.value=""},onKeyDown:e=>{W(e)}}),s.jsx(J,{className:`fa fa-close ${u.close}`,content:"Cancel",func:()=>{y(!1)}})]}),F==null?void 0:F.map((e,t)=>s.jsxs("label",{htmlFor:b!=null?e.id:null,className:e.type=="folder"?e.isSelected?`${u.selected} ${u.folder}`:`${u.folder}`:e.isSelected?`${u.selected} ${u.file}`:`${u.file}`,onDoubleClick:()=>{B||(N(e.name),L(e.id))},children:[s.jsx("input",{type:"checkbox",style:B?{display:"block"}:{display:"none"},checked:!!e.isSelected,onChange:()=>{B&&w(e)}}),e.type=="folder"?s.jsx("i",{className:"fa fa-folder"}):s.jsx(oe,{folder:e}),b!=null&&A==e.id?s.jsx("input",{id:e.id,type:"text",value:b,onKeyDown:a=>{q(a,e)},onBlur:()=>[N(null),L(null)],onChange:a=>{N(a.target.value)}}):s.jsx("span",{children:e.name}),e.type=="folder"?s.jsx("button",{className:u.open,onClick:()=>{Z(e)},children:"Open"}):s.jsx("a",{className:u.open,href:e.url,children:"Open"})]},e.dateCreated))]})]})})};export{Ge as default,te as foldersContext};
