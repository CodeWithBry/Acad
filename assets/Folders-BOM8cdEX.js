import{j as s,r as n,c as Q,B as X,f as ee,h as Y,i as se,d as T,a as E,k as re,l as ce,u as Z,g as ie,m as de}from"./index-Ck4Otn4t.js";const pe="_foldersWrapper_wjit0_9",ue="_foldersBottomNav_wjit0_70",he="_foldersBox_wjit0_100",fe="_folderPathWrapper_wjit0_112",me="_hideFolderInput_wjit0_133",xe="_folderInput_wjit0_137",ge="_close_wjit0_137",_e="_folder_wjit0_9",je="_file_wjit0_142",Ne="_open_wjit0_175",Fe="_selected_wjit0_207",u={foldersWrapper:pe,foldersBottomNav:ue,foldersBox:he,folderPathWrapper:fe,hideFolderInput:me,folderInput:xe,close:ge,folder:_e,file:je,open:Ne,selected:Fe},Be="_foldersBottomNav_9h9hf_1",ye="_left_9h9hf_8",ve="_uncheck_9h9hf_8",Ce="_right_9h9hf_17",we="_fullContent_9h9hf_32",w={foldersBottomNav:Be,left:ye,uncheck:ve,right:Ce,fullContent:we},be=({deleteSelectedFolder:c,setSelecting:f,handleSelectingAll:h})=>s.jsxs("div",{className:w.foldersBottomNav,children:[s.jsxs("div",{className:w.left,children:[s.jsxs("button",{onClick:()=>{h(!0)},children:[s.jsx("i",{className:"fa fa-check"}),s.jsx("span",{className:w.fullContent,children:"Select All"})]}),s.jsxs("button",{onClick:()=>{h(!1)},children:[s.jsx("i",{className:`fa fa-check-square ${w.uncheck}`}),s.jsx("span",{className:w.fullContent,children:"Unselect All"})]})]}),s.jsxs("div",{className:w.right,children:[s.jsxs("button",{onClick:()=>{c()},children:[s.jsx("i",{className:"fa fa-trash"}),s.jsx("span",{className:w.fullContent,children:"Delete"})]}),s.jsxs("button",{onClick:()=>{f(!1),h(!1)},children:[s.jsx("i",{className:"fa fa-close"}),s.jsx("span",{className:w.fullContent,children:"Cancel"})]})]})]}),Se="_foldersNav_8tlzv_1",Pe="_horizontalLine_8tlzv_10",ke="_right_8tlzv_24",We="_uploadWrapper_8tlzv_33",M={foldersNav:Se,horizontalLine:Pe,right:ke,uploadWrapper:We},Ue="_uploaderWrapper_11yss_1",$e="_progressBarWrapper_11yss_14",De="_hidesProgressBarWrapper_11yss_14",Ie="_showProgressButton_11yss_39",Re="_progressBarBox_11yss_56",Ae="_uploadingFile_11yss_70",Le="_wrapNameAndBar_11yss_101",Oe="_bar_11yss_109",ze="_barColor_11yss_117",Me="_wrapNameAndProgress_11yss_124",Te="_uploaderBox_11yss_136",Ee="_uploaderBoxLabel_11yss_149",Ke="_closeButton_11yss_164",p={uploaderWrapper:Ue,progressBarWrapper:$e,hidesProgressBarWrapper:De,showProgressButton:Ie,progressBarBox:Re,uploadingFile:Ae,wrapNameAndBar:Le,bar:Oe,barColor:ze,wrapNameAndProgress:Me,uploaderBox:Te,uploaderBoxLabel:Ee,closeButton:Ke},qe=({uploaderPrompt:c,setUploaderPrompt:f})=>{const h=n.useRef(),{user:b,setLoading:S,setFoldersCache:K}=n.useContext(Q),{folderPath:W,setFilesAndFolders:q,filesAndFolders:P}=n.useContext(te),[v,C]=n.useState(!1),[V,R]=n.useState(!0),[U,$]=n.useState([]),[N,A]=n.useState([]),L=async i=>{var r,m;S(!0);const o=i;C(!0);for(let d=0;d<o.length;d++)$(B=>[...B,{prog:0,name:o[d].name}]);A([...o]);for(let d=0;d<o.length;d++){let B="qwertyuiopasdfghjklzxcvbnm",g="";for(let y=0;y<15;y++){let _=Math.floor(Math.random()*B.length);g=g.concat(B[_])}const O=ee(se,`${(r=Y.currentUser)==null?void 0:r.uid}/${W}/${g+"_"+o[d].name}`),k=T(E,"Users",(m=Y.currentUser)==null?void 0:m.uid);try{if(o[d]){var F=P;const y=re(O,o[d]);y.on("state_changed",_=>{const D=Math.floor(_.bytesTransferred/_.totalBytes*100);$(z=>z.map((I,G)=>I.name==o[d].name?{...I,prog:D}:{...I}))},_=>{console.log(_)},()=>{ce(y.snapshot.ref).then(_=>{q(D=>[{name:o[d].name,fileType:o[d].type,fullName:g+"_"+o[d].name,url:_,dateCreated:Date.now(),isSelected:!1,id:Math.random()*1,type:"file",path:W},...D]),F.push({name:o[d].name,fileType:o[d].type,fullName:g+"_"+o[d].name,url:_,dateCreated:Date.now(),isSelected:!1,id:Math.random()*1,type:"file",path:W}),K([...F]),Z(k,{folders:P})})})}}catch{console.log("No file selected."),S(!1)}}S(!1)};if(c)return s.jsxs("div",{className:p.uploaderWrapper,children:[s.jsx("input",{type:"file",id:"fileUploader",accept:"*",ref:h,onChange:i=>{L(i.target.files)},multiple:!0}),s.jsxs("div",{className:v?p.progressBarWrapper:p.hidesProgressBarWrapper,children:[s.jsx(X,{icon:v?s.jsx("i",{className:"fa fa-arrow-up"}):s.jsx("i",{className:"fa fa-arrow-down"}),content:v?"Hide Progress Bar":"Show Progress Bar",func:()=>{C(!v)},className:p.showProgressButton}),s.jsx("h3",{children:"Progress Bar"}),s.jsxs("div",{className:p.progressBarBox,children:[s.jsx("h4",{children:"Files:"}),N==null?void 0:N.map((i,o)=>{var F,r,m;return s.jsxs("div",{className:p.uploadingFile,children:[i.type.includes("image")?s.jsx("img",{src:URL.createObjectURL(i)}):s.jsx("i",{className:"fa fa-file"}),s.jsxs("div",{className:p.wrapNameAndBar,children:[s.jsx("div",{className:p.bar,children:s.jsx("div",{className:p.barColor,style:{width:`${(F=U[o])==null?void 0:F.prog}%`}})}),s.jsxs("div",{className:p.wrapNameAndProgress,children:[s.jsx("span",{className:p.name,children:(r=U[o])==null?void 0:r.name}),s.jsxs("span",{className:p.progress,children:[(m=U[o])==null?void 0:m.prog,"%"]})]})]})]},i==null?void 0:i.lastModified)})]})]}),s.jsxs("div",{className:V?p.uploaderBox:p.hideUploaderBox,children:[s.jsx(X,{icon:s.jsx("i",{className:"fa fa-close"}),className:p.closeButton,func:()=>{f(!1)}}),s.jsxs("label",{className:p.uploaderBoxLabel,htmlFor:"fileUploader",onDragOver:i=>{i.preventDefault()},onDrop:i=>{i.preventDefault(),L(i.dataTransfer.files)},children:[s.jsx("img",{src:"./Folder/cloudUpload.png",alt:""}),s.jsx("p",{children:"Click to Upload"}),s.jsx("p",{children:"or Drop Files to Upload"})]})]})]})},Ve=({setShowFolderInput:c})=>{const[f,h]=n.useState(!1);return s.jsxs("div",{className:M.foldersNav,children:[s.jsx("h1",{children:"Folders"}),s.jsxs("div",{className:M.right,children:[s.jsx("button",{children:"Create"}),s.jsxs("div",{className:M.uploadWrapper,children:[s.jsxs("button",{onClick:()=>{h(!0)},children:[s.jsx("i",{className:"fa fa-file"}),s.jsx("span",{children:"Upload File"})]}),s.jsxs("button",{onClick:()=>{c(!0)},children:[s.jsx("i",{className:"	fa fa-folder"}),s.jsx("label",{htmlFor:"folderInput",children:"Create Folder"})]})]})]}),s.jsx("span",{className:M.horizontalLine}),s.jsx(qe,{uploaderPrompt:f,setUploaderPrompt:b=>{h(b)}})]})},te=n.createContext(),He=()=>{const{user:c,setLoading:f,foldersCache:h,setFoldersCache:b,setShowMakeUserSignIn:S}=n.useContext(Q),{setPages:K,imageContent:W,setImageContent:q}=n.useContext(Q),P=n.useRef(null),[v,C]=n.useState(null),[V,R]=n.useState(null),[U,$]=n.useState(!1),[N,A]=n.useState(!1),[L,i]=n.useState(!1),[o,F]=n.useState("Folders/"),[r,m]=n.useState(h),[d,B]=n.useState([]),[g,O]=n.useState([{name:"Folders",path:"Folders/"}]),[k,y]=n.useState([]);function _(e){let t=r,a=[];for(let l in t)e.id==t[l].id&&(t[l].isSelected=!t[l].isSelected);for(let l in r)r[l].isSelected&&a.push(r[l]);console.log(),y([...a]),m([...t])}function D(e){B(l=>l.map(x=>({...x,isSelected:!!e})));let t=r,a=[];for(let l in t)t[l].isSelected=!!e,e&&a.push(t[l].id);y([...a])}function z(e){console.log(o);const t={name:e.target.value,dateCreated:Date.now(),isSelected:!1,id:Math.floor(Math.random()*1e6),type:"folder",path:o},a=e.target.value;if(e.key=="Enter"){if(a!=""){let x=[t,...r];H(x),m(j=>[t,...j])}else i(!1);i(!1),e.target.value=""}}function I(e,t){const a=e.target.value,l=e.key;let x=r;console.log(t.name),l=="Enter"&&(a!=""?(x=x.map(j=>t.name==j.name?{...j,name:a}:{...j}),H(x),m(j=>j.map(J=>t.name==J.name?{...J,name:a}:{...J}))):R(null),C(null))}function G(e){let t=[],a=g;if(console.log(a.length),a.length!=1){for(let l in t)t[l].path==o&&t.push(t[l]);for(let l in g)if(g[l].path==e.path){for(let x=g.length-1;x!=l;x--)a.splice(x,1);break}O([...a]),B([...t])}}function ae(e){if(e.type=="folder"){e!=null&&e.name&&F(o+(e==null?void 0:e.name)+"/"),O(a=>[...a,{name:e==null?void 0:e.name,path:(e==null?void 0:e.path)+(e==null?void 0:e.name)+"/"}]);let t=[];for(let a in t)t[a].path==o&&t.push(t[a]);B([...t])}else $(!0)}const le=async()=>{var t;let e=r;if(e.length!=0){f(!0);try{for(let a in k)for(let l in e)k[a].id==e[l].id&&(k[a].type=="folder"||await de(ee(se,`/${(t=Y.currentUser)==null?void 0:t.uid}/${o}/${k[a].fullName}`)),e.splice(l,1));await Z(T(E,"Users",c.uid),{folders:e}),f(!1)}catch(a){console.log(a),f(!1)}y([]),m([...e])}},H=async e=>{const t=T(E,"Users",c==null?void 0:c.uid);console.log(e),e&&b([...e]);try{await Z(t,{folders:e||r})}catch(a){console.log(a)}};n.useEffect(()=>{if(o!=""){console.log(r);let e=[],t=[],a=[];for(let l in r)r[l].path===o&&e.push(r[l]);for(let l in e)e[l].type=="folders"?a.push(e[l]):t.push(e[l]);b([...a,...t]),a&&t&&B([...a,...t])}console.log(r)},[o,r]),n.useEffect(()=>{if((h==null?void 0:h.length)==0&&c){const e=async t=>{var a;f(!0);try{const l=T(E,"Users",t),j=(a=(await ie(l)).data())==null?void 0:a.folders;j.length!=0&&(m([...j]),b([...j])),f(!1)}catch(l){console.log(l),f(!1)}f(!1)};c!=null&&c.uid&&e(c.uid)}},[h,c]),n.useEffect(()=>{c!=null&&c.uid?S(!1):S(!0)},[c]),n.useEffect(()=>{K(e=>e.map(t=>t.name==="Folders"?{...t,ind:!0}:{...t,ind:!1}))},[]);const oe={openFile:U,setOpenFile:$,imageContent:W,setImageContent:q,folderPath:o,setFilesAndFolders:m,filesAndFolders:r,folderInputRef:P,saveToDatabase:()=>{H()}},ne=({folder:e})=>s.jsx(s.Fragment,{children:e.fileType.includes("image")?s.jsx("input",{type:"image",src:e.url,width:"16px",style:{marginRight:"1rem"}}):s.jsx("i",{className:"fa fa-file"})});return s.jsx(te.Provider,{value:oe,children:s.jsxs("div",{className:u.foldersWrapper,children:[s.jsx(Ve,{createFolder:z,setShowFolderInput:i}),N?s.jsx(be,{selecting:N,setSelecting:A,handleSelectingAll:D,deleteSelectedFolder:le}):s.jsx("div",{className:u.foldersBottomNav,children:s.jsx("button",{onClick:()=>{A(!0)},children:"Select Folders"})}),s.jsxs("div",{className:u.foldersBox,children:[s.jsx("div",{className:u.folderPathWrapper,children:s.jsx("h3",{children:g.map(e=>e.path=="Folders/"?s.jsx("span",{children:s.jsxs("span",{onClick:()=>{F(e.path),G(e)},children:[e.name," "]})},e.name+e.path):s.jsxs("span",{children:["/ ",s.jsxs("span",{onClick:()=>{F(e.path),G(e)},children:[e.name," "]})]},e.name+e.path))})}),s.jsxs("div",{className:L?u.folderInput:u.hideFolderInput,children:[s.jsx("i",{className:"fa fa-folder"}),s.jsx("input",{type:"text",ref:P,id:"folderInput",onBlur:()=>{i(!1),P.current.value=""},onKeyDown:e=>{z(e)}}),s.jsx(X,{className:`fa fa-close ${u.close}`,content:"Cancel",func:()=>{i(!1)}})]}),d==null?void 0:d.map((e,t)=>s.jsxs("label",{htmlFor:v!=null?e.id:null,className:e.type=="folder"?e.isSelected?`${u.selected} ${u.folder}`:`${u.folder}`:e.isSelected?`${u.selected} ${u.file}`:`${u.file}`,onDoubleClick:()=>{N||(C(e.name),R(e.id))},children:[s.jsx("input",{type:"checkbox",style:N?{display:"block"}:{display:"none"},checked:!!e.isSelected,onChange:()=>{N&&_(e)}}),e.type=="folder"?s.jsx("i",{className:"fa fa-folder"}):s.jsx(ne,{folder:e}),v!=null&&V==e.id?s.jsx("input",{id:e.id,type:"text",value:v,onKeyDown:a=>{I(a,e)},onBlur:()=>[C(null),R(null)],onChange:a=>{C(a.target.value)}}):s.jsx("span",{children:e.name}),e.type=="folder"?s.jsx("button",{className:u.open,onClick:()=>{ae(e)},children:"Open"}):s.jsx("a",{className:u.open,href:e.url,children:"Open"})]},e.dateCreated))]})]})})};export{He as default,te as foldersContext};
